# ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å–µ–º

## ‚úÖ –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

### 1. Email API –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ YANDEX_IAM_TOKEN —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (249 —Å–∏–º–≤–æ–ª–æ–≤)
- ‚úÖ YANDEX_CLOUD_FROM_EMAIL –Ω–∞—Å—Ç—Ä–æ–µ–Ω (noreply@iventapp.ru)
- ‚úÖ YANDEX_CLOUD_API_ENDPOINT –Ω–∞—Å—Ç—Ä–æ–µ–Ω (https://mail-api.cloud.yandex.net)
- ‚úÖ EMAIL_VERIFICATION_REDIRECT_URL –Ω–∞—Å—Ç—Ä–æ–µ–Ω (https://iventapp.ru/auth/verify)

### 2. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –í—Å–µ –∞–∫–∫–∞—É–Ω—Ç—ã —É–¥–∞–ª–µ–Ω—ã (0 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- ‚úÖ –í—Å–µ –ª–æ–≥–∏–Ω—ã —É–¥–∞–ª–µ–Ω—ã
- ‚úÖ –í—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã
- ‚úÖ –ë–∞–∑–∞ –≥–æ—Ç–æ–≤–∞ –¥–ª—è –Ω–æ–≤–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

### 3. –ö–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ MailerService –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Yandex Cloud Email API
- ‚úÖ –õ–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å–µ–º –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è HTTPS

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É Email

### –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω:

1. **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å** –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —Å —Ä–µ–∞–ª—å–Ω—ã–º email –∞–¥—Ä–µ—Å–æ–º
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É** (–≤–∫–ª—é—á–∞—è –ø–∞–ø–∫—É "–°–ø–∞–º")
3. **–î–æ–ª–∂–µ–Ω –ø—Ä–∏–π—Ç–∏ –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è** –æ—Ç `noreply@iventapp.ru`

### –ï—Å–ª–∏ –ø–∏—Å—å–º–æ –Ω–µ –ø—Ä–∏—à–ª–æ:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
   ```bash
   ssh -i ~/.ssh/yandex-cloud ubuntu@89.169.173.152
   pm2 logs event-app | grep -i 'mail\|email\|yandex'
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ IAM —Ç–æ–∫–µ–Ω –Ω–µ –∏—Å—Ç–µ–∫:**
   - IAM —Ç–æ–∫–µ–Ω—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã 12 —á–∞—Å–æ–≤
   - –ï—Å–ª–∏ –∏—Å—Ç–µ–∫ - –æ–±–Ω–æ–≤–∏—Ç–µ (—Å–º. –Ω–∏–∂–µ)

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞–ø–∫—É "–°–ø–∞–º"** - –ø–∏—Å—å–º–∞ –º–æ–≥—É—Ç –ø–æ–ø–∞–¥–∞—Ç—å —Ç—É–¥–∞

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å email –∞–¥—Ä–µ—Å–∞** –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ IAM —Ç–æ–∫–µ–Ω–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ IAM —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫ (—á–µ—Ä–µ–∑ 12 —á–∞—Å–æ–≤):

```bash
# –ù–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
NEW_TOKEN=$(yc iam create-token)

# –ù–∞ VM
ssh -i ~/.ssh/yandex-cloud ubuntu@89.169.173.152
cd ~/event_app_new/server
sed -i "s|^YANDEX_IAM_TOKEN=.*|YANDEX_IAM_TOKEN=$NEW_TOKEN|" .env
pm2 restart event-app --update-env
```

## ‚úÖ –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

–ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç email –∏ –ø–∞—Ä–æ–ª—å
2. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/auth/register`
3. –°–µ—Ä–≤–µ—Ä —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
4. –°–µ—Ä–≤–µ—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
5. –°–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∏—Å—å–º–æ —á–µ—Ä–µ–∑ Yandex Cloud Email API
6. –ü–∏—Å—å–º–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π email —Å –∫–æ–¥–æ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
7. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –∫–æ–¥ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
8. Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è

## üìã –õ–æ–≥–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

–í –ª–æ–≥–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:

**–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ:**
```
‚úÖ Yandex Cloud Email API enabled (from: noreply@iventapp.ru)
```

**–ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:**
```
[MailerService] –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–∏—Å—å–º–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞: user@example.com
[MailerService] ‚úÖ –ü–∏—Å—å–º–æ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ Yandex Cloud
```

**–ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏:**
```
[MailerService] ‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å—å–º–∞: ...
```

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

1. **IAM —Ç–æ–∫–µ–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 12 —á–∞—Å–æ–≤** - –ø–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞–ø–∫—É "–°–ø–∞–º"** - –ø–∏—Å—å–º–∞ –º–æ–≥—É—Ç –ø–æ–ø–∞–¥–∞—Ç—å —Ç—É–¥–∞
3. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–º–µ–Ω iventapp.ru –Ω–∞—Å—Ç—Ä–æ–µ–Ω** –≤ Yandex Cloud Email API
4. **DKIM –∑–∞–ø–∏—Å–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã** (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–æ –≤–∞—à–∏–º –¥–∞–Ω–Ω—ã–º)

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–∏—Å—å–º–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π email.

