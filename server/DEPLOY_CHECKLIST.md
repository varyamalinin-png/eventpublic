# ✅ Чеклист перед деплоем

## Проблемы которые были исправлены:

1. ✅ **Удален весь старый код Mailgun/SMTP** - теперь используется только Yandex Cloud Email API
2. ✅ **Заменен fetch на https модуль** - для совместимости с Node.js
3. ✅ **Улучшена обработка ошибок** - теперь логируются все детали
4. ✅ **Удалены все упоминания SMTP/SendGrid** из auth.controller и auth.service

## Что нужно проверить после деплоя:

### 1. Переменные окружения установлены в Railway:
- `YANDEX_IAM_TOKEN` - установлена ✅
- `YANDEX_CLOUD_FROM_EMAIL` - установлена ✅
- `YANDEX_CLOUD_API_ENDPOINT` - опционально

### 2. Проверить логи сервера:
После деплоя должны появиться:
```
✅ Yandex Cloud Email API enabled (from: noreply@iventapp.ru)
```

НЕ должны появляться:
- ❌ "Using Mailgun API"
- ❌ "Using SMTP"
- ❌ "Mailgun check"

### 3. Тестирование:
1. Зарегистрировать нового пользователя
2. Проверить, что письмо отправляется через Yandex Cloud
3. Проверить логи - должны быть только сообщения о Yandex Cloud

## Если проблемы остались:

1. **Проверить переменные окружения на сервере:**
   ```bash
   cd server && node scripts/check-server-config.js
   ```

2. **Обновить IAM токен** (если истек):
   ```bash
   cd server && node scripts/get-yandex-iam-token.js
   ```

3. **Проверить, что новая версия задеплоена:**
   - Убедиться, что Railway пересобрал проект
   - Проверить, что используется новая версия из dist

## Важно:

- IAM токен действителен **12 часов**
- После установки переменных **перезапустите сервис**
- Если видны упоминания Mailgun/SMTP - значит запущена старая версия

