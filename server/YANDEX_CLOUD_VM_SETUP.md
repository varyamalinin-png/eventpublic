# ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è VM –≤ Yandex Cloud

## üìã –í–∞—à–∞ —Ç–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

‚úÖ **–û–±—Ä–∞–∑**: Ubuntu 24.04 LTS - –æ—Ç–ª–∏—á–Ω–æ!
‚úÖ **–ó–æ–Ω–∞**: ru-central1-b - —Ö–æ—Ä–æ—à–æ
‚úÖ **–î–∏—Å–∫**: 20 –ì–ë - –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
‚úÖ **vCPU**: 2 - –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –Ω–∞—á–∞–ª–∞
‚úÖ **RAM**: 4 –ì–ë - –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
‚úÖ **–ü—É–±–ª–∏—á–Ω—ã–π IP**: –≤–∫–ª—é—á–µ–Ω - –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
‚úÖ **–ò–º—è**: event-app-backend - —Ö–æ—Ä–æ—à–æ

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 1. SSH-–∫–ª—é—á (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)

**–í–ê–ñ–ù–û**: –ë–µ–∑ SSH-–∫–ª—é—á–∞ –≤—ã –Ω–µ —Å–º–æ–∂–µ—Ç–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ VM!

**–í–∞—Ä–∏–∞–Ω—Ç A: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π SSH-–∫–ª—é—á**
```bash
# –ù–∞ –≤–∞—à–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
ssh-keygen -t rsa -b 4096 -C "your-email@example.com" -f ~/.ssh/yandex-cloud

# –ü–æ–∫–∞–∑–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
cat ~/.ssh/yandex-cloud.pub
```

**–í–∞—Ä–∏–∞–Ω—Ç B: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–ª—é—á**
```bash
# –ü–æ–∫–∞–∑–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
cat ~/.ssh/id_rsa.pub
```

**–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á** –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –ø–æ–ª–µ "SSH-–∫–ª—é—á" –≤ Yandex Cloud.

### 2. –ì—Ä—É–ø–ø–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø—Ä–∞–≤–∏–ª–∞:**
- **–í—Ö–æ–¥—è—â–∏–µ**: 
  - SSH (22/tcp) - –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É
  - HTTP (80/tcp) - –¥–ª—è –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
  - HTTPS (443/tcp) - –¥–ª—è SSL
  - –ü–æ—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (4000/tcp) - –µ—Å–ª–∏ –Ω—É–∂–µ–Ω –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø

### 3. –°–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Object Storage –∏ –¥—Ä—É–≥–∏–º —Å–µ—Ä–≤–∏—Å–∞–º Yandex Cloud.

### 4. Cloud Backup (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–í–∫–ª—é—á–∏—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö.

## üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å

–í–∞—à–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: **~2512‚ÇΩ/–º–µ—Å**
- vCPU: 1632.96‚ÇΩ
- RAM: 435.46‚ÇΩ
- –î–∏—Å–∫: 257.26‚ÇΩ
- –ü—É–±–ª–∏—á–Ω—ã–π IP: 186.62‚ÇΩ

–≠—Ç–æ —Ö–æ—Ä–æ—à–∞—è —Ü–µ–Ω–∞ –¥–ª—è –Ω–∞—á–∞–ª–∞!

## üöÄ –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è VM

### –®–∞–≥ 1: –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ VM

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –ø–æ SSH
ssh ubuntu@<–ø—É–±–ª–∏—á–Ω—ã–π-ip-–∞–¥—Ä–µ—Å>

# –ò–ª–∏ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–π –∫–ª—é—á:
ssh -i ~/.ssh/yandex-cloud ubuntu@<–ø—É–±–ª–∏—á–Ω—ã–π-ip-–∞–¥—Ä–µ—Å>
```

### –®–∞–≥ 2: –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```bash
# –ù–∞ VM
cd /tmp
wget https://raw.githubusercontent.com/varyamalinin-png/eventpublic/main/server/yandex-cloud-setup.sh
chmod +x yandex-cloud-setup.sh
sudo ./yandex-cloud-setup.sh
```

### –®–∞–≥ 3: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
# –ù–∞ VM
cd /opt/event-app
git clone https://github.com/varyamalinin-png/eventpublic.git .
cd server
```

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ù–∞ VM
cd /opt/event-app/server
cp yandex-cloud-env-template.env .env
nano .env  # –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è
```

### –®–∞–≥ 5: –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
# –ù–∞ VM
cd /opt/event-app/server
npm install --legacy-peer-deps
npm run prisma:generate
npm run build
npm run prisma:deploy
pm2 start ecosystem.config.js
pm2 save
```

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –ù–∞—Å—Ç—Ä–æ–∏—Ç—å firewall (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

```bash
# –ù–∞ VM
sudo ufw allow 22/tcp    # SSH
sudo ufw allow 80/tcp    # HTTP
sudo ufw allow 443/tcp   # HTTPS
sudo ufw enable
```

### –ù–∞—Å—Ç—Ä–æ–∏—Ç—å swap (–µ—Å–ª–∏ –º–∞–ª–æ RAM)

```bash
# –ù–∞ VM
sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **SSH-–∫–ª—é—á –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω** - –±–µ–∑ –Ω–µ–≥–æ –Ω–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–∞!
2. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á** - –µ—Å–ª–∏ –ø–æ—Ç–µ—Ä—è–µ—Ç–µ, –¥–æ—Å—Ç—É–ø –±—É–¥–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≥—Ä—É–ø–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** - –æ—Ç–∫—Ä–æ–π—Ç–µ –Ω—É–∂–Ω—ã–µ –ø–æ—Ä—Ç—ã
4. **–í–∫–ª—é—á–∏—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
5. **–ó–∞–ø–∏—à–∏—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π IP** - –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

## üìù –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º

- [ ] SSH-–∫–ª—é—á —Å–æ–∑–¥–∞–Ω –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω
- [ ] –ò–º—è VM: event-app-backend
- [ ] –ó–æ–Ω–∞: ru-central1-b
- [ ] –î–∏—Å–∫: 20 –ì–ë
- [ ] vCPU: 2, RAM: 4 –ì–ë
- [ ] –ü—É–±–ª–∏—á–Ω—ã–π IP: –≤–∫–ª—é—á–µ–Ω
- [ ] –ì—Ä—É–ø–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] Cloud Backup –≤–∫–ª—é—á–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## üéØ –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è

1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –ø–æ SSH
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
3. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
5. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**–ì–æ—Ç–æ–≤–æ!** üöÄ

