# ‚úÖ Email API –Ω–∞—Å—Ç—Ä–æ–µ–Ω

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

1. ‚úÖ –ü–æ–ª—É—á–µ–Ω IAM —Ç–æ–∫–µ–Ω –¥–ª—è Yandex Cloud
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `YANDEX_IAM_TOKEN` –≤ `.env` –Ω–∞ VM
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Email API
4. ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–æ

## üìß –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Email API

- **–î–æ–º–µ–Ω**: `iventapp.ru`
- **–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å**: `noreply@iventapp.ru`
- **DKIM**: –ù–∞—Å—Ç—Ä–æ–µ–Ω (–∑–∞–ø–∏—Å—å `postbox._domainkey.iventapp.ru`)
- **API Endpoint**: `https://mail-api.cloud.yandex.net`

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –≤ .env:
```bash
ssh -i ~/.ssh/yandex-cloud ubuntu@89.169.173.152
cd ~/event_app_new/server
grep YANDEX_IAM_TOKEN .env
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
```bash
pm2 logs event-app | grep -i mail
```

### –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å—å–º–∞:
–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ - –ø–∏—Å—å–º–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π email.

## ‚ö†Ô∏è –ï—Å–ª–∏ –ø–∏—Å—å–º–∞ –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   pm2 logs event-app --lines 100 | grep -i 'mail\|email\|yandex'
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω:**
   ```bash
   yc iam create-token
   ```
   –û–±–Ω–æ–≤–∏—Ç–µ —Ç–æ–∫–µ–Ω –≤ `.env` –µ—Å–ª–∏ –Ω—É–∂–Ω–æ (—Ç–æ–∫–µ–Ω—ã –∏—Å—Ç–µ–∫–∞—é—Ç —á–µ—Ä–µ–∑ 12 —á–∞—Å–æ–≤)

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ DKIM –∑–∞–ø–∏—Å—å:**
   –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ DNS –∑–∞–ø–∏—Å—å `postbox._domainkey.iventapp.ru` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–º–µ–Ω –≤ Yandex Cloud:**
   –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–º–µ–Ω `iventapp.ru` –∞–∫—Ç–∏–≤–µ–Ω –≤ Yandex Cloud Email API

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

IAM —Ç–æ–∫–µ–Ω—ã –∏—Å—Ç–µ–∫–∞—é—Ç —á–µ—Ä–µ–∑ 12 —á–∞—Å–æ–≤. –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–æ–∂–Ω–æ:

1. **–°–æ–∑–¥–∞—Ç—å service account** –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –∫–ª—é—á
2. **–ò–ª–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–∫–µ–Ω –≤—Ä—É—á–Ω—É—é:**
   ```bash
   NEW_TOKEN=$(yc iam create-token)
   ssh -i ~/.ssh/yandex-cloud ubuntu@89.169.173.152 "cd ~/event_app_new/server && sed -i 's|^YANDEX_IAM_TOKEN=.*|YANDEX_IAM_TOKEN=$NEW_TOKEN|' .env && pm2 restart event-app"
   ```

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

Email API –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ. –ü–∏—Å—å–º–∞ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ Yandex Cloud Email API —Å –∞–¥—Ä–µ—Å–∞ `noreply@iventapp.ru`.

