# Инструкция по исправлению события "ramen" на виртуальной машине

## Проблема
Событие "ramen" не отображается в разделе Memories (прошедшие события) в профиле участника, хотя оно есть в параметре "участник" в шапке профиля.

## Причина
Скорее всего, для события "ramen" не создан `EventProfile`, или участник не добавлен в `EventProfile.participants`.

## Решение

### Вариант 1: Использовать скрипт для автоматического исправления

1. Подключитесь к виртуальной машине через SSH:
   ```bash
   ssh user@your-vm-ip
   ```

2. Перейдите в директорию проекта:
   ```bash
   cd /path/to/event_app_new/server
   ```

3. Запустите скрипт для проверки и исправления:
   ```bash
   DATABASE_URL="postgresql://user:password@host:port/database" node scripts/fix-ramen-event-profile.js
   ```

   Скрипт:
   - Найдет событие "ramen"
   - Проверит, является ли оно прошедшим
   - Создаст `EventProfile`, если его нет
   - Добавит всех участников со статусом `ACCEPTED` в `EventProfile.participants`

### Вариант 2: Использовать скрипт для проверки (без исправления)

1. Запустите скрипт для проверки:
   ```bash
   DATABASE_URL="postgresql://user:password@host:port/database" node scripts/check-ramen-event.js
   ```

   Скрипт выведет:
   - Информацию о событии "ramen"
   - Список всех участников и их статусы
   - Наличие `EventProfile` и участников в нём

### Вариант 3: Исправить вручную через Prisma Studio

1. Подключитесь к виртуальной машине
2. Запустите Prisma Studio:
   ```bash
   cd /path/to/event_app_new/server
   npx prisma studio
   ```
3. Найдите событие "ramen" в таблице `Event`
4. Проверьте, есть ли `EventProfile` для этого события
5. Если нет - создайте `EventProfile` и добавьте всех участников со статусом `ACCEPTED` в `EventProfileParticipant`

## После исправления

После того, как `EventProfile` будет создан и участники добавлены:
1. Перезапустите сервер (если нужно)
2. В клиентском приложении обновите данные (pull-to-refresh в профиле)
3. Событие "ramen" должно появиться в разделе Memories

## Изменения в коде

Также были внесены изменения в код:
1. **Клиент**: `client/app/(tabs)/profile.tsx` - улучшена логика фильтрации `pastEvents` для участников
2. **Сервер**: `server/src/events/event-profiles.service.ts` - добавлено автоматическое создание `EventProfile` при запросе профиля прошедшего события

Эти изменения гарантируют, что:
- Прошедшие события автоматически получают `EventProfile` при первом запросе
- Все участники со статусом `ACCEPTED` автоматически добавляются в `EventProfile.participants`

