#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –ø—Ä–æ–µ–∫—Ç—É Railway

set -e

echo "üîó –ü—Ä–∏–≤—è–∑–∫–∞ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –ø—Ä–æ–µ–∫—Ç—É Railway..."
echo ""

cd "$(dirname "$0")/server" || exit 1

RAILWAY="npx -y @railway/cli"

echo "üìã –í–∞—Ä–∏–∞–Ω—Ç 1: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≤—ã–±–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞"
echo "   –ö–æ–º–∞–Ω–¥–∞ –ø–æ–∫–∞–∂–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≤–∞—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤"
echo ""
echo "üìã –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ ID –ø—Ä–æ–µ–∫—Ç–∞"
echo "   npx -y @railway/cli link <PROJECT_ID>"
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Å–≤—è–∑—å
if [ -f ".railway/config.toml" ]; then
    echo "‚ö†Ô∏è  –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Å–≤—è–∑—å"
    echo "   –¢–µ–∫—É—â–∏–π –ø—Ä–æ–µ–∫—Ç:"
    cat .railway/config.toml | grep -E "(project|service)" || echo "   (–Ω–µ –Ω–∞–π–¥–µ–Ω–æ)"
    echo ""
    read -p "–£–¥–∞–ª–∏—Ç—å —Ç–µ–∫—É—â—É—é —Å–≤—è–∑—å –∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é? (y/n) " -n 1 -r
    echo ""
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        echo "üóëÔ∏è  –£–¥–∞–ª—è–µ–º —Ç–µ–∫—É—â—É—é —Å–≤—è–∑—å..."
        rm -rf .railway
        echo "‚úÖ –£–¥–∞–ª–µ–Ω–æ"
        echo ""
    else
        echo "‚ùå –û—Ç–º–µ–Ω–µ–Ω–æ"
        exit 0
    fi
fi

echo "üîó –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –∫ –ø—Ä–æ–µ–∫—Ç—É..."
echo ""
echo "–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è: $RAILWAY link"
echo "–í—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ–µ–∫—Ç –∏–∑ —Å–ø–∏—Å–∫–∞"
echo ""

$RAILWAY link

echo ""
echo "‚úÖ –ì–æ—Ç–æ–≤–æ!"
echo ""
echo "–ü—Ä–æ–≤–µ—Ä–∫–∞:"
$RAILWAY status

