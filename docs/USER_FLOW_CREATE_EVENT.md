# User Flow: Создание и публикация события

## Описание сценария

Пользователь хочет создать новое событие (например, "Встреча в парке") и пригласить друзей.

---

## Детальный User Flow

### 1. Начало сценария

**Точка входа**: Пользователь находится на главной ленте (Explore) или в своем профиле.

**Действие**: Пользователь нажимает кнопку "Создать событие"
- **Мобильная версия**: Таб "Create" в нижней навигации
- **Веб-версия**: Кнопка "Создать" в меню или на странице создания события

**Результат**: Переход на экран создания события (`/(tabs)/create` или `/create-event`)

---

### 2. Заполнение формы создания события

#### 2.1. Основная информация

**Шаг 2.1.1: Название события**
- **Действие**: Пользователь вводит название события
- **Пример**: "Встреча в парке Горького"
- **Валидация**: Обязательное поле, минимум 3 символа

**Шаг 2.1.2: Описание события**
- **Действие**: Пользователь вводит описание (опционально)
- **Пример**: "Приглашаю всех на прогулку в парке. Возьмем плед, что-нибудь перекусить"
- **Характеристики**: Многострочный текст, лимит символов (например, 500)

**Шаг 2.1.3: Категория события**
- **Действие**: Пользователь выбирает категорию из списка
- **Опции**: Спорт, Культура, Развлечения, Образование, Встреча, Другое
- **Результат**: Событие будет отображаться в соответствующем разделе

---

#### 2.2. Дата и время

**Шаг 2.2.1: Дата события**
- **Действие**: Пользователь выбирает дату события
- **Мобильная версия**: Нативный DatePicker
- **Веб-версия**: HTML date input
- **Валидация**: Дата должна быть в будущем (или сегодня)

**Шаг 2.2.2: Время начала**
- **Действие**: Пользователь выбирает время начала
- **Мобильная версия**: Нативный TimePicker
- **Веб-версия**: HTML time input
- **Пример**: "15:00"

**Шаг 2.2.3: Время окончания (опционально)**
- **Действие**: Пользователь может указать время окончания
- **Пример**: "18:00"

---

#### 2.3. Место проведения

**Шаг 2.3.1: Выбор способа указания места**
- **Вариант A**: Ввод адреса текстом
  - Пользователь вводит адрес в поле "Место"
  - Пример: "Парк Горького, Москва"
  
- **Вариант B**: Выбор на карте
  - Пользователь нажимает "Выбрать на карте"
  - Переход на `/select-location`
  - Открывается карта (Yandex Maps)
  - Пользователь кликает на место
  - Подтверждение выбора
  - Возврат к форме с заполненным адресом и координатами

**Результат**: Заполнено поле "Место" с адресом и координатами (lat, lng)

---

#### 2.4. Медиа контент

**Шаг 2.4.1: Загрузка изображения**
- **Действие**: Пользователь нажимает "Добавить фото"
- **Мобильная версия**: 
  - Выбор между камерой и галереей
  - `ImagePicker.launchImageLibraryAsync()` или `launchCameraAsync()`
- **Веб-версия**:
  - Нативный `<input type="file">`
  - Поддержка drag & drop (если реализовано)
- **Результат**: Предпросмотр загруженного изображения

**Шаг 2.4.2: Удаление/замена изображения (опционально)**
- Пользователь может удалить или заменить изображение

---

#### 2.5. Настройки приватности

**Шаг 2.5.1: Тип события**
- **Варианты**:
  - **Публичное**: Видно всем в глобальной ленте
  - **Приватное**: Видно только друзьям
  - **Только для приглашенных**: Видно только тем, кому отправлено приглашение

**Шаг 2.5.2: Ограничения (если есть)**
- Максимальное количество участников
- Возрастные ограничения
- Требования (например, "Только для друзей")

---

### 3. Предпросмотр и отправка

**Шаг 3.1: Предпросмотр**
- **Действие**: Пользователь просматривает все заполненные данные
- **Отображение**: Карточка события в формате предпросмотра
- **Проверка**: Все обязательные поля заполнены

**Шаг 3.2: Публикация**
- **Действие**: Пользователь нажимает кнопку "Создать событие" или "Опубликовать"
- **Процесс**:
  1. Валидация всех полей на клиенте
  2. Показ индикатора загрузки
  3. Отправка POST запроса на `/api/events`
  4. Загрузка изображения (если есть)
  5. Создание записи события в БД
  6. Уведомление пользователя об успехе
- **Результат**: Событие создано и сохранено

---

### 4. После создания события

**Шаг 4.1: Переход к событию**
- **Действие**: Автоматический переход на страницу созданного события (`/event-profile/[id]`)
- **Отображение**: Детальная страница события со всеми данными

**Шаг 4.2: Приглашение друзей (опционально)**
- **Действие**: Пользователь может пригласить друзей
- **Способы**:
  - Через кнопку "Пригласить друзей" на странице события
  - Выбор друзей из списка
  - Отправка приглашений
- **Результат**: Друзья получают уведомление/запрос на участие

**Шаг 4.3: Поделиться событием**
- **Действие**: Пользователь может поделиться ссылкой на событие
- **Варианты**:
  - Копировать ссылку
  - Поделиться через социальные сети
  - Отправить через мессенджер

---

### 5. Альтернативные пути (Error Handling)

#### 5.1. Ошибка валидации
- **Условие**: Не заполнены обязательные поля
- **Действие**: Показ ошибок валидации под соответствующими полями
- **Результат**: Пользователь исправляет ошибки и повторяет попытку

#### 5.2. Ошибка сети
- **Условие**: Проблема с интернет-соединением
- **Действие**: Показ сообщения об ошибке
- **Опции**:
  - Повторить попытку
  - Сохранить в черновик (если реализовано)

#### 5.3. Отмена создания
- **Действие**: Пользователь нажимает "Отмена" или "Назад"
- **Результат**: 
  - Предупреждение о потере данных (если заполнена форма)
  - Возврат на предыдущий экран
  - Данные не сохраняются (или сохраняются в черновик)

---

## Визуальная схема User Flow

```
┌─────────────────┐
│   Explore/      │
│   Profile       │
└────────┬────────┘
         │ [Нажать "Создать"]
         ▼
┌─────────────────┐
│  Create Event   │
│  (Form)         │
└────────┬────────┘
         │
    ┌────┴────┐
    │         │
    ▼         ▼
┌────────┐ ┌──────────┐
│ Select │ │ Upload   │
│Location│ │  Image   │
│(Map)   │ │          │
└───┬────┘ └────┬─────┘
    │           │
    └─────┬─────┘
          │ [Заполнить все поля]
          ▼
┌─────────────────┐
│   Preview +     │
│   Validate      │
└────────┬────────┘
         │
    ┌────┴────┐
    │         │
    ▼         ▼
┌────────┐ ┌──────────┐
│Success │ │  Error   │
│Publish │ │  Handle  │
└───┬────┘ └────┬─────┘
    │           │
    ▼           │
┌──────────────┐│
│ Event Detail ││
│   Page       ││
└──────┬───────┘│
       │        │
       └────────┘
         │
    ┌────┴────┐
    │         │
    ▼         ▼
┌────────┐ ┌──────────┐
│Invite  │ │  Share   │
│Friends │ │  Event   │
└────────┘ └──────────┘
```

---

## Технические детали

### API Endpoints

1. **POST `/api/events`** - Создание события
   - Body: { title, description, date, time, location, category, privacy, image }
   - Response: { eventId, ...eventData }

2. **POST `/api/events/[id]/image`** - Загрузка изображения события
   - Multipart/form-data
   - Response: { imageUrl }

3. **POST `/api/events/[id]/invite`** - Приглашение друзей
   - Body: { userIds: string[] }
   - Response: { success: boolean }

### Состояние приложения

- **Событие создается** → Добавляется в `events` контекст
- **Обновляется список событий** → В Explore и профиле пользователя
- **Уведомления** → Друзья получают уведомления (если приглашены)

### Платформенные особенности

**Мобильная версия**:
- Нативные пикеры для даты/времени
- Доступ к камере для фото
- Нативная навигация

**Веб-версия**:
- HTML inputs для даты/времени
- File input для изображения
- Карта встроена через iframe (Yandex Maps)

---

## Метрики успеха

1. **Время создания события**: Среднее время от начала до публикации
2. **Процент завершения**: Сколько пользователей начали создание и довели до конца
3. **Ошибки валидации**: Частота ошибок при заполнении формы
4. **Успешные публикации**: Количество успешно созданных событий

---

## Улучшения (Future Enhancements)

1. **Черновики**: Сохранение незавершенных событий для последующего редактирования
2. **Шаблоны**: Предустановленные шаблоны для часто создаваемых событий
3. **Рекуррентные события**: Создание повторяющихся событий
4. **Предварительный просмотр**: Live preview карточки события во время заполнения
5. **Социальные интеграции**: Автоматическое создание события в календаре устройства
